# å°çº¢ä¹¦ç¬”è®°ç›‘æ§å™¨æ•…éšœæ’æŸ¥æŒ‡å—

## é—®é¢˜: ç›‘æ§å™¨å¡åœ¨"æ­£åœ¨è·å–ç”¨æˆ·ç¬”è®°åˆ—è¡¨"

### ç—‡çŠ¶
è¿è¡Œ `monitor_user_notes.py` åæ˜¾ç¤ºï¼š
```
ğŸ“‹ æ­£åœ¨è·å–ç”¨æˆ· 5657d81c7c5bb814405de598 çš„ç¬”è®°åˆ—è¡¨...
```
ç„¶åå°±ä¸€ç›´å¡ä½ï¼Œæ²¡æœ‰è¿›ä¸€æ­¥è¾“å‡ºã€‚

### åŸå› åˆ†æ

ç›‘æ§å™¨å¡ä½é€šå¸¸æ˜¯å› ä¸º**ç­¾åç”Ÿæˆè¿‡ç¨‹**å‡ºç°é—®é¢˜ã€‚`monitor_user_notes.py` ä½¿ç”¨ Playwright å¯åŠ¨æµè§ˆå™¨æ¥ç”Ÿæˆå°çº¢ä¹¦ API æ‰€éœ€çš„ç­¾åï¼ˆx-s å’Œ x-t å‚æ•°ï¼‰ï¼Œå¦‚æœè¿™ä¸ªè¿‡ç¨‹å¤±è´¥æˆ–è¶…æ—¶ï¼Œç¨‹åºå°±ä¼šå¡ä½ã€‚

å¯èƒ½çš„å…·ä½“åŸå› ï¼š
1. **Playwright æµè§ˆå™¨æœªæ­£ç¡®å®‰è£…**
2. **ç½‘ç»œé—®é¢˜** - æ— æ³•è®¿é—® xiaohongshu.com
3. **é¡µé¢åŠ è½½è¶…æ—¶** - å°çº¢ä¹¦é¡µé¢åŠ è½½æ—¶é—´è¿‡é•¿
4. **ç­¾åå‡½æ•°ä¸å­˜åœ¨** - `window._webmsxyw` å‡½æ•°æœªåŠ è½½
5. **ç³»ç»Ÿèµ„æºä¸è¶³** - æµè§ˆå™¨å¯åŠ¨å¤±è´¥

---

## è§£å†³æ–¹æ¡ˆ

### æ­¥éª¤ 1: è¿è¡Œè¯Šæ–­å·¥å…·

æˆ‘ä»¬æä¾›äº†ä¸€ä¸ªè¯Šæ–­å·¥å…·æ¥å¿«é€Ÿå®šä½é—®é¢˜ï¼š

```bash
cd example
python test_sign.py
```

è¿™ä¸ªå·¥å…·ä¼šï¼š
- âœ… æ£€æŸ¥ Playwright æ˜¯å¦æ­£ç¡®å®‰è£…
- âœ… æ£€æŸ¥ Chromium æµè§ˆå™¨æ˜¯å¦å¯ç”¨
- âœ… æµ‹è¯•åŸºæœ¬çš„ç­¾ååŠŸèƒ½
- âœ… æµ‹è¯•å¸¦ Cookie çš„ç­¾ååŠŸèƒ½
- âœ… æä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯

### æ­¥éª¤ 2: æ ¹æ®è¯Šæ–­ç»“æœè§£å†³é—®é¢˜

#### é—®é¢˜ A: Playwright æˆ– Chromium æœªå®‰è£…

**é”™è¯¯ä¿¡æ¯:**
```
âŒ Playwright æœªå®‰è£…!
```
æˆ–
```
âŒ Chromium æµè§ˆå™¨ä¸å¯ç”¨
```

**è§£å†³æ–¹æ³•:**
```bash
# å®‰è£… Playwright
pip install playwright

# å®‰è£… Chromium æµè§ˆå™¨
playwright install chromium
```

#### é—®é¢˜ B: ç­¾åå‡½æ•°ä¸å­˜åœ¨

**é”™è¯¯ä¿¡æ¯:**
```
âŒ ç­¾åå‡½æ•°ä¸å­˜åœ¨!
typeof window._webmsxyw = undefined
```

**å¯èƒ½åŸå› :**
1. é¡µé¢åŠ è½½ä¸å®Œæ•´
2. å°çº¢ä¹¦æ›´æ–°äº†å‰ç«¯ä»£ç 
3. éœ€è¦å…ˆç™»å½•

**è§£å†³æ–¹æ³•:**

**æ–¹æ³• 1: å¢åŠ ç­‰å¾…æ—¶é—´**

ç¼–è¾‘ `monitor_user_notes.py`ï¼Œåœ¨ç­¾åå‡½æ•°ä¸­å¢åŠ ç­‰å¾…æ—¶é—´ï¼š
```python
# å°† sleep(2) æ”¹ä¸º sleep(5)
sleep(5)
```

**æ–¹æ³• 2: ä½¿ç”¨éæ— å¤´æ¨¡å¼è°ƒè¯•**

ç¼–è¾‘ `monitor_config.json`:
```json
{
  "use_headless": false,
  ...
}
```

è¿™æ ·å¯ä»¥çœ‹åˆ°æµè§ˆå™¨çª—å£ï¼Œè§‚å¯Ÿé¡µé¢åŠ è½½æƒ…å†µã€‚

**æ–¹æ³• 3: ä½¿ç”¨å¤‡ç”¨ç­¾åæœåŠ¡**

è€ƒè™‘ä½¿ç”¨é¡¹ç›®æä¾›çš„ `xhs-api` ç­¾åæœåŠ¡ï¼ˆå¦‚æœå¯ç”¨ï¼‰ã€‚

#### é—®é¢˜ C: ç½‘ç»œé—®é¢˜

**é”™è¯¯ä¿¡æ¯:**
```
TimeoutError: Timeout 30000ms exceeded
```
æˆ–æ— æ³•è¿æ¥åˆ° xiaohongshu.com

**è§£å†³æ–¹æ³•:**

1. **æ£€æŸ¥ç½‘ç»œè¿æ¥**
   ```bash
   curl https://www.xiaohongshu.com
   ```

2. **é…ç½®ä»£ç†** (å¦‚æœéœ€è¦)
   
   ç¼–è¾‘ `monitor_user_notes.py`ï¼Œåœ¨æµè§ˆå™¨å¯åŠ¨æ—¶æ·»åŠ ä»£ç†ï¼š
   ```python
   browser = chromium.launch(
       headless=use_headless,
       proxy={"server": "http://your-proxy:port"}
   )
   ```

3. **å¢åŠ è¶…æ—¶æ—¶é—´**
   
   ç¼–è¾‘ `monitor_user_notes.py`:
   ```python
   context_page.set_default_timeout(60000)  # ä» 30000 æ”¹ä¸º 60000
   ```

#### é—®é¢˜ D: Cookie æ— æ•ˆ

**ç—‡çŠ¶:** å³ä½¿ç­¾åæˆåŠŸï¼Œä»ç„¶æ— æ³•è·å–ç¬”è®°åˆ—è¡¨

**è§£å†³æ–¹æ³•:**

1. **é‡æ–°è·å– Cookie**
   - æ‰“å¼€æµè§ˆå™¨ï¼Œç™»å½•å°çº¢ä¹¦ç½‘é¡µç‰ˆ
   - æ‰“å¼€å¼€å‘è€…å·¥å…· (F12)
   - è®¿é—®ä»»æ„é¡µé¢
   - åœ¨ Network æ ‡ç­¾ä¸­æ‰¾åˆ°è¯·æ±‚
   - å¤åˆ¶ Cookie å€¼

2. **æ›´æ–°é…ç½®æ–‡ä»¶**
   ç¼–è¾‘ `monitor_config.json`:
   ```json
   {
     "cookie": "your_new_cookie_here",
     ...
   }
   ```

3. **éªŒè¯ Cookie æ ¼å¼**
   Cookie åº”è¯¥åŒ…å«ä»¥ä¸‹å…³é”®å­—æ®µ:
   - `a1=...`
   - `web_session=...`
   
   ç¤ºä¾‹:
   ```
   a1=xxxxx; webId=xxxxx; web_session=xxxxx; ...
   ```

### æ­¥éª¤ 3: ä½¿ç”¨å¢å¼ºç‰ˆç›‘æ§å™¨

æˆ‘ä»¬å·²ç»æ›´æ–°äº† `monitor_user_notes.py`ï¼Œæ·»åŠ äº†è¯¦ç»†çš„æ—¥å¿—è¾“å‡ºã€‚ç°åœ¨è¿è¡Œæ—¶ä¼šæ˜¾ç¤ºï¼š

```
ğŸ“‹ æ­£åœ¨è·å–ç”¨æˆ· 5657d81c7c5bb814405de598 çš„ç¬”è®°åˆ—è¡¨...
   ğŸ” æ­£åœ¨ç”Ÿæˆç­¾å (URI: /api/sns/web/v1/user_posted?...)
   ğŸŒ å¯åŠ¨æµè§ˆå™¨ (headless=True)...
   ğŸ“¡ åŠ è½½å°çº¢ä¹¦é¡µé¢...
   â³ ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆ...
   ğŸ” æ£€æŸ¥ç­¾åå‡½æ•°æ˜¯å¦å­˜åœ¨...
   âœ¨ æ‰§è¡Œç­¾åå‡½æ•°...
   âœ… ç­¾åç”ŸæˆæˆåŠŸ
```

å¦‚æœå¡åœ¨æŸä¸€æ­¥ï¼Œå°±å¯ä»¥çŸ¥é“å…·ä½“å“ªé‡Œå‡ºäº†é—®é¢˜ã€‚

### æ­¥éª¤ 4: é‡æ–°è¿è¡Œç›‘æ§å™¨

```bash
cd example  # æˆ–ä½ çš„å·¥ä½œç›®å½•
python monitor_user_notes.py
```

å¦‚æœåªæƒ³æµ‹è¯•ä¸€æ¬¡ï¼ˆä¸æŒç»­ç›‘æ§ï¼‰ï¼š
```bash
python monitor_user_notes.py --once
```

---

## é…ç½®å»ºè®®

### æ¨èçš„é…ç½®æ–‡ä»¶ (monitor_config.json)

```json
{
  "cookie": "your_cookie_here",
  "user_id": "target_user_id_here",
  "download_dir": "./downloads",
  "check_interval": 300,
  "stealth_js_path": "./stealth.min.js",
  "use_headless": true,
  "max_retries": 3,
  "retry_delay": 2,
  "downloaded_notes_file": "downloaded_notes.json"
}
```

### é…ç½®å­—æ®µè¯´æ˜

| å­—æ®µ | è¯´æ˜ | é»˜è®¤å€¼ | å»ºè®® |
|------|------|--------|------|
| `cookie` | å°çº¢ä¹¦ Cookie | - | å¿…å¡«ï¼Œéœ€å®šæœŸæ›´æ–° |
| `user_id` | è¦ç›‘æ§çš„ç”¨æˆ·ID | - | å¿…å¡« |
| `download_dir` | ä¸‹è½½ç›®å½• | `./downloads` | å¯è‡ªå®šä¹‰ |
| `check_interval` | æ£€æŸ¥é—´éš”(ç§’) | 300 | å»ºè®® â‰¥ 300ï¼Œé¿å…é¢‘ç¹è¯·æ±‚ |
| `stealth_js_path` | stealth.js è·¯å¾„ | `./stealth.min.js` | å¯é€‰ï¼Œä½†æ¨èä½¿ç”¨ |
| `use_headless` | æ— å¤´æ¨¡å¼ | true | è°ƒè¯•æ—¶è®¾ä¸º false |
| `max_retries` | æœ€å¤§é‡è¯•æ¬¡æ•° | 3 | ç½‘ç»œä¸ç¨³å®šæ—¶å¯å¢åŠ  |
| `retry_delay` | é‡è¯•å»¶è¿Ÿ(ç§’) | 2 | - |

---

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. å‡å°‘ç­¾åè°ƒç”¨
ç­¾åç”Ÿæˆéœ€è¦å¯åŠ¨æµè§ˆå™¨ï¼Œæ¯”è¾ƒè€—æ—¶ã€‚å¯ä»¥è€ƒè™‘ï¼š
- å¢åŠ æ£€æŸ¥é—´éš” (`check_interval`)
- ä½¿ç”¨å¤–éƒ¨ç­¾åæœåŠ¡ï¼ˆå¦‚é¡¹ç›®ä¸­çš„ xhs-apiï¼‰

### 2. ä½¿ç”¨ stealth.js
ä¸‹è½½ `stealth.min.js` å¯ä»¥é™ä½è¢«æ£€æµ‹ä¸ºæœºå™¨äººçš„é£é™©ï¼š
```bash
wget https://cdn.jsdelivr.net/npm/puppeteer-extra-plugin-stealth@latest/stealth.min.js
```

### 3. é¿å…é¢‘ç¹è¯·æ±‚
- `check_interval` è®¾ç½®ä¸ºè‡³å°‘ 5 åˆ†é’Ÿï¼ˆ300ç§’ï¼‰
- ä½¿ç”¨ `sleep()` åœ¨æ‰¹é‡æ“ä½œä¹‹é—´æ·»åŠ å»¶è¿Ÿ

---

## å¸¸è§é—®é¢˜ FAQ

### Q1: ä¸ºä»€ä¹ˆéœ€è¦ Cookie?
A: Cookie ç”¨äºèº«ä»½éªŒè¯ï¼Œæ²¡æœ‰æœ‰æ•ˆçš„ Cookie æ— æ³•è®¿é—®å°çº¢ä¹¦ APIã€‚

### Q2: Cookie å¤šä¹…å¤±æ•ˆ?
A: é€šå¸¸ 1-7 å¤©ï¼Œå–å†³äºå°çº¢ä¹¦çš„ç­–ç•¥ã€‚å»ºè®®å®šæœŸæ›´æ–°ã€‚

### Q3: å¯ä»¥åŒæ—¶ç›‘æ§å¤šä¸ªç”¨æˆ·å—?
A: å¯ä»¥è¿è¡Œå¤šä¸ªç›‘æ§å™¨å®ä¾‹ï¼Œæ¯ä¸ªä½¿ç”¨ä¸åŒçš„é…ç½®æ–‡ä»¶ï¼š
```bash
python monitor_user_notes.py --config user1_config.json &
python monitor_user_notes.py --config user2_config.json &
```

### Q4: å¦‚ä½•è·å– user_id?
A: 
1. è®¿é—®ç”¨æˆ·ä¸»é¡µï¼Œå¦‚ `https://www.xiaohongshu.com/user/profile/5657d81c7c5bb814405de598`
2. URL ä¸­çš„æœ€åä¸€éƒ¨åˆ†å°±æ˜¯ user_id

### Q5: ç›‘æ§å™¨å ç”¨èµ„æºå¤ªå¤šæ€ä¹ˆåŠ?
A: 
- ç¡®ä¿ä½¿ç”¨æ— å¤´æ¨¡å¼ (`use_headless: true`)
- å¢åŠ æ£€æŸ¥é—´éš”
- å…³é—­ä¸éœ€è¦çš„æµè§ˆå™¨æ‰©å±•

### Q6: å¯ä»¥åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œå—?
A: å¯ä»¥ï¼Œä½†éœ€è¦å®‰è£…ç›¸å…³ä¾èµ–ï¼š
```bash
# Ubuntu/Debian
apt-get install -y wget unzip fontconfig locales gconf-service libasound2 \
  libatk1.0-0 libc6 libcairo2 libcups2 libdbus-1-3 libexpat1 libfontconfig1 \
  libgcc1 libgconf-2-4 libgdk-pixbuf2.0-0 libglib2.0-0 libgtk-3-0 libnspr4 \
  libpango-1.0-0 libpangocairo-1.0-0 libstdc++6 libx11-6 libx11-xcb1 libxcb1 \
  libxcomposite1 libxcursor1 libxdamage1 libxext6 libxfixes3 libxi6 libxrandr2 \
  libxrender1 libxss1 libxtst6 ca-certificates fonts-liberation libappindicator1 \
  libnss3 lsb-release xdg-utils

# ç„¶åå®‰è£… Playwright æµè§ˆå™¨
playwright install --with-deps chromium
```

---

## è”ç³»æ”¯æŒ

å¦‚æœä»¥ä¸Šæ–¹æ³•éƒ½æ— æ³•è§£å†³é—®é¢˜ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. `test_sign.py` çš„å®Œæ•´è¾“å‡º
2. `monitor_user_notes.py` çš„è¾“å‡ºï¼ˆæ˜¾ç¤ºå¡åœ¨å“ªä¸€æ­¥ï¼‰
3. æ“ä½œç³»ç»Ÿå’Œ Python ç‰ˆæœ¬
4. ç½‘ç»œç¯å¢ƒï¼ˆæ˜¯å¦ä½¿ç”¨ä»£ç†ç­‰ï¼‰

---

## æ›´æ–°æ—¥å¿—

### 2025-01-29
- âœ… æ·»åŠ è¯¦ç»†çš„æ—¥å¿—è¾“å‡º
- âœ… æ·»åŠ é¡µé¢åŠ è½½è¶…æ—¶æ§åˆ¶
- âœ… æ·»åŠ ç­¾åå‡½æ•°å­˜åœ¨æ€§æ£€æŸ¥
- âœ… åˆ›å»º `test_sign.py` è¯Šæ–­å·¥å…·
- âœ… åˆ›å»ºæœ¬æ•…éšœæ’æŸ¥æŒ‡å—
